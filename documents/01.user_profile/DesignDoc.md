# プロフィール機能のDesign Doc

## 背景と目的

### やること

- プロフィールを設定可能にする
- プロフィールの公開・非公開を切り替えられる
- 他者のアカウントをフォローできる

### やらないこと

- プロフィールの削除機能

## 機能仕様

### プロフィール登録機能

- プロフィールには複数の画像を添付できる（プロフィール画像としてアップロードできるのは1枚）
  - 画像添付にはRails標準のActive Storageを利用する（本番ではGCSを利用する想定）
  - 画像なしの場合、デフォルト画像が表示される

→ 最初の操作ではプロフィール情報のみ登録させる。その後編集画面からプロフィール画像を設定できるような仕様とする

### プロフィール公開・非公開切り替え機能

- ユーザーは自身のプロフィールを他人から見れる状態とするかを選択できる

### プロフィール設定機能

## システムデザイン・アーキテクチャ

### データベース

#### usersテーブル

- アプリケーション内でのアカウントを表すテーブル

| 論理名         | 物理名       | データ型     | デフォルト値      | Null 許可 | キー | 備考 |
| -------------- | ------------ | ------------ | ----------------- | --------- | ---- | ---- |
| id             | id           | bigint       |                   |           | PK   |      |
| アカウント名   | name         | varchar(50)  |                   |           |      |      |
| メールアドレス | email        | varchar(254) |                   |           |      |      |
| 外部認証ID     | supabase_uid | varchar      |                   |           |      |      |
| 作成日時       | created_at   | datetime     | CURRENT_TIMESTAMP |           |      |      |
| 更新日時       | updated_at   | datetime     |                   | ⚪︎      |      |      |

#### profilesテーブル

- アカウントに紐づくプロフィールを表現するテーブル

| 論理名       | 物理名     | データ型 | デフォルト値      | Null 許可 | キー | 備考                     |
| ------------ | ---------- | -------- | ----------------- | --------- | ---- | ------------------------ |
| id           | id         | bigint   |                   |           | PK   |                          |
| ユーザーid   | user_id    | bigint   |                   |           | FK   |                          |
| 生年月日     | birthday   | datetime |                   |           |      |                          |
| 生物学的性別 | sex        | int      | 0                 |           |      | 0:secret, 1:man, 2:woman |
| 公開設定     | is_public  | boolean  | 0                 |           |      | 0:非公開、1:公開         |
| 作成日時     | created_at | datetime | CURRENT_TIMESTAMP |           |      |                          |
| 更新日時     | updated_at | datetime |                   | ⚪︎      |      |                          |

### インターフェース

#### プロフィール作成API

`POST /api/profile`
パラメータ

```
{
  profile: {
    birthday: '1990/01/01',
    sex: 1,
    is_public: true
  }
}
```

レスポンス

```
{}
```

#### プロフィール更新API

`PUT /api/profile`
パラメータ

```
{
  profile: {
    birthday: '1990/01/01',
    sex: 1,
    is_public: true
  }
}
```

レスポンス

```
{}
```
