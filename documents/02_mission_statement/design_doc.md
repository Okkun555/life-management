# ミッションステートメント機能のDesign Doc

## 概要
ミッションステートメントとは、その人が「どんな人生を生きるか？」という意思を文章であり、自分の価値観や最も一番大事にしているものを軸に作成される。
これを定めておくことで、目標設定をする上で何が本当に自分にとって大切か判断する指針とできる。

ミッションステートメントを記録できるだけでなく、検討をサポートできるよう機能として提供する。

## やること

- ミッションステートメントの検討サポート機能を提供
- ミッションステートメントの登録、編集機能
- ミッションステートメントの履歴機能（過去の時点ではどんな考え方だったのかを振り返れる）

## やらないこと

- 他人のミッションステートメントを見れる
- AIが壁打ち相手になってくれる
- 手書きのミッションステートメントを画像を自動で読み込める

## 機能仕様

### ミッションステートメント作成サポート機能
ミッションステートメントの検討は難しいので、「7つの習慣」に用意されている質問に答える形式で、ミッションステートメントを検討するサポートができるようにしたい。

#### 仕様
- 検討フェーズはフォームに自由記載でき、記述内容はauto saveされる
- 入力文字制限は10000文字とする
- 9900文字から文字カウンターが表示される
- フォームにはmd形式で記入でき、プレビュー画面も表示される
- 役割に関してはinputフォームを追加できる形にする

### ミッションステートメント記録機能
サポート機能で整理した情報を元にミッションステートメントを検討する機能

#### 仕様
- 役割はサポート機能で入力した内容が自動で反映される
- 役割ごとミッションステートメントを明文化できる
- 役割の順番を入れ替えられる
- サポート事項で検討した内容を確認しながら入力できる
- 最大15個とする
- 一つのミッションステートメントは30文字以内とする

### ミッションステートメント更新
ミッションステートメントは、変更することができる。しかし、編集ではなく新しいミッションステートメントを作成する。

- 過去のミッションステートメントもバージョン管理できる。
  - サポート機能は管理しない
- 更新する際、既存のミッションステートメントをコピーできる。
- 時系列とともに確認できる。また、そこに変化をメモできる。

## 技術選定
### ミッションステートメントのバージョン管理
独自実装する方法と、`paper_trail`や`acts_as_versioned`のようなgemを利用する方法がある。

#### 各gemの比較
- [paper_trail](https://github.com/paper-trail-gem/paper_trail)
  - ruby 3.2.0以降の対応Verがリリースされていないので不可
- [acts_as_versioned]
  - 更新が10数年実施されていないので不可
→ 独自実装で進める方針とする

## テーブル設計
### mission_statement_values
サポート機能フェーズ1のデータを格納

| 論理名       | 物理名       | データ型 | デフォルト | null許可 | キー | 備考 |
| ------------ | ------------ | -------- | ---------- | -------- | ---- | ---- |
| ID           | id           | bigint   |            |          | PK   |      |
| ユーザーID   | user_id      | bigint   |            |          | FK   |      |
| 内容         | content      | text     |            |          |      |      |
| 作成日時 | created_at | datetime | CURRENT_TIMESTAMP |          |      |      |
| 更新日時 | updated_at | datetime | CURRENT_TIMESTAMP | ⚪︎     |      |      |


### mission_statement_roles
サポート機能フェーズ2のデータを格納

| 論理名       | 物理名       | データ型     | デフォルト        | null許可 | キー | 備考 |
| ------------ | ------------ | ------------ | ----------------- | -------- | ---- | ---- |
| ID           | id           | bigint       |                   |          | PK   |      |
| ユーザーID   | user_id      | bigint       |                   |          | FK   |      |
| 役割         | role         | varchar(100) |                   |          |      |      |
| 作成日時     | created_at   | datetime     | CURRENT_TIMESTAMP |          |      |      |
| 更新日時     | updated_at   | datetime     | CURRENT_TIMESTAMP | ⚪︎     |      |      |


### mission_statement_goals
サポート機能フェーズ3のデータを格納

| 論理名       | 物理名       | データ型     | デフォルト        | null許可 | キー | 備考 |
| ------------ | ------------ | ------------ | ----------------- | -------- | ---- | ---- |
| ID           | id           | bigint       |                   |          | PK   |      |
| ユーザーID   | user_id      | bigint       |                   |          | FK   |      |
| 役割ID       | role_id      | bigint       |                   |          |      | FK   |
| 目標         | goal         | varchar(140) |                   |          |      |      |
| 作成日時     | created_at   | datetime     | CURRENT_TIMESTAMP |          |      |      |
| 更新日時     | updated_at   | datetime     | CURRENT_TIMESTAMP | ⚪︎     |      |      |


### mission_statements
| 論理名         | 物理名     | データ型 | デフォルト        | null許可 | キー | 備考 |
| -------------- | ---------- | -------- | ----------------- | -------- | ---- | ---- |
| ID             | id         | bigint   |                   |          | PK   |      |
| ユーザーID     | user_id    | bigint   |                   |          | FK   |      |
| 内容           | content    | varchar(100)     |                   |          |      |      |
| バージョン管理 | version    | int      | 1                 |          |      |      |
| 作成日時       | created_at | datetime | CURRENT_TIMESTAMP |          |      |      |
| 更新日時       | updated_at | datetime | CURRENT_TIMESTAMP | ⚪︎     |      |      |

- user_id, mission_statement_id, versionの複合ユニーク
- 通常編集 or バージョン更新を選択させて、その選択肢次第でversionカラムを更新する
